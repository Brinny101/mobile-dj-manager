var mdjm_admin_vars;jQuery(document).ready(function(a){function b(){if("manual"===a("#venue_id").val()||"client"===a("#venue_id").val())a(".mdjm-event-venue-details-sections-wrap").hide("fast"),a(".mdjm-add-event-venue-sections-wrap").show("fast");else{a(".mdjm-add-event-venue-sections-wrap").hide("fast");var b={venue_id:a("#venue_id").val(),event_id:a("#post_ID").val(),action:"mdjm_refresh_venue_details"};a.ajax({type:"POST",dataType:"json",data:b,url:ajaxurl,success:function(b){a("#mdjm-venue-details-fields").html(b.data.venue),a(".mdjm-event-venue-details-sections-wrap").show("fast");var c=a(".toggle-event-view-venue-option-section").html()===mdjm_admin_vars.show_venue_details;c&&a(".toggle-event-view-venue-option-section").html(mdjm_admin_vars.hide_venue_details)}}).fail(function(a){window.console&&window.console.log&&console.log(a)}),e()}a("#_mdjm_event_package").trigger("change")}a(".mdjm-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:mdjm_admin_vars.one_option,placeholder_text_multiple:mdjm_admin_vars.one_or_more_option}),a(".mdjm-select-chosen .chosen-search input").each(function(){var b=a(this).parent().parent().parent().prev("select.mdjm-select-chosen"),c=b.data("search-placeholder");a(this).attr("placeholder",c)}),a(".chosen-choices").on("click",function(){var b=a(this).parent().prev().data("search-placeholder");"undefined"==typeof b&&(b=mdjm_admin_vars.type_to_search),a(this).children("li").children("input").attr("placeholder",b)}),a(document).on("click",".notice-mdjm-dismiss .notice-dismiss",function(){var b=a(this).closest(".notice-mdjm-dismiss").data("notice"),c={notice:b,action:"mdjm_dismiss_notice"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl})});var c=function(){var b=a("#_mdjm_event_deposit").val(),c={current_cost:a("#_mdjm_event_cost").val(),action:"update_event_deposit"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#_mdjm_event_deposit").attr("readonly",!0),a("#mdjm-event-pricing-detail").addClass("mdjm-mute")},success:function(c){"success"===c.type?a("#_mdjm_event_deposit").val(c.deposit):(alert(c.msg),a("#_mdjm_event_deposit").val(b)),a("#mdjm-event-pricing-detail").removeClass("mdjm-mute"),a("#_mdjm_event_deposit").attr("readonly",!1)}}).fail(function(c){window.console&&window.console.log&&console.log(c),a("#_mdjm_event_deposit").val(b)})},d=function(){var b,d=a("#_mdjm_event_cost").val();b="manual"===a("#venue_id").val()||"client"===a("#venue_id").val()?[a("#venue_address1").val(),a("#venue_address2").val(),a("#venue_town").val(),a("#venue_county").val(),a("#venue_postcode").val()]:a("#venue_id").val();var e={addons:a("#event_addons").val()||[],package:a("#_mdjm_event_package option:selected").val(),event_id:a("#post_ID").val(),current_cost:a("#_mdjm_event_cost").val(),event_date:a("#_mdjm_event_date").val(),venue:b,employee_id:a("#_mdjm_event_dj").val(),additional:a("#_mdjm_event_additional_cost").val(),discount:a("#_mdjm_event_discount").val(),action:"mdjm_update_event_cost"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#mdjm-event-pricing-detail").addClass("mdjm-mute")},success:function(b){if("success"===b.type){a("#_mdjm_event_package_cost").val(b.package_cost),a("#_mdjm_event_addons_cost").val(b.addons_cost),a("#_mdjm_event_travel_cost").val(b.travel_cost),a("#_mdjm_event_additional_cost").val(b.additional_cost),a("#_mdjm_event_discount").val(b.discount);var e=Number(b.package_cost)+Number(b.addons_cost)+Number(b.travel_cost)+Number(b.additional_cost);e=Number(e)-Number(b.discount),e=mdjmFormatCurrency(e).substr(1),a("#_mdjm_event_cost").val(e),mdjm_admin_vars.update_deposit&&c()}else a("#_mdjm_event_cost").val(d);a("#mdjm-event-pricing-detail").removeClass("mdjm-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},e=function(){var b;b="manual"===a("#venue_id").val()||"client"===a("#venue_id").val()?[a("#venue_address1").val(),a("#venue_address2").val(),a("#venue_town").val(),a("#venue_county").val(),a("#venue_postcode").val()]:a("#venue_id").val();var c={employee_id:a("#_mdjm_event_dj").val(),venue:b,action:"mdjm_update_travel_data"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){"success"===b.type?(a(".mdjm-travel-distance").parents("tr").show(),a(".mdjm-travel-directions").parents("tr").show(),a(".mdjm-travel-distance").html(b.distance),a(".mdjm-travel-time").html(b.time),a(".mdjm-travel-cost").html(b.cost),a("#travel_directions").attr("href",b.directions_url),a("#mdjm_travel_distance").val(b.distance),a("#mdjm_travel_time").val(b.time),a("#mdjm_travel_cost").val(b.raw_cost),a("#mdjm_travel_directions_url").val(b.directions_url)):(a(".mdjm-travel-distance").parents("tr").hide(),a("#travel-directions").attr("href",""),a(".mdjm-travel-directions").parents("tr").hide(),a("#mdjm_travel_distance").val(""),a("#mdjm_travel_time").val(""),a("#mdjm_travel_cost").val(""),a("#mdjm_travel_directions_url").val(""))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},f={init:function(){"admin_page_mdjm-custom-event-fields"!==mdjm_admin_vars.current_page&&"admin_page_mdjm-custom-client-fields"!==mdjm_admin_vars.current_page||this.custom_fields()},custom_fields:function(){jQuery(document).ready(function(a){a(".mdjm-client-list-item").sortable({handle:".mdjm_draghandle",items:".mdjm_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize",{expression:/(.+)=(.+)/})+"&action=mdjm_update_client_field_order";a.post(ajaxurl,b,function(){})}})}),a(".mdjm-custom-client-list-item,.mdjm-custom-event-list-item,.mdjm-custom-venue-list-item").sortable({handle:".mdjm_draghandle",items:".mdjm_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize")+"&action=order_custom_event_fields";a.post(ajaxurl,b,function(){})}})}};f.init();var g={init:function(){this.options(),this.client(),this.employee(),this.equipment(),this.playlist(),this.tasks(),this.time(),this.travel(),this.type(),this.txns(),this.venue()},options:function(){a(document.body).on("click",".toggle-event-options-section",function(b){b.preventDefault();var c=a(this).html()===mdjm_admin_vars.show_event_options;c?a(this).html(mdjm_admin_vars.hide_event_options):a(this).html(mdjm_admin_vars.show_event_options),a(".mdjm-event-options-sections-wrap").slideToggle()})},client:function(){a(document.body).on("click",".toggle-client-add-option-section",function(b){b.preventDefault();var c=a(this).html()===mdjm_admin_vars.show_client_form;c?a(this).html(mdjm_admin_vars.hide_client_form):a(this).html(mdjm_admin_vars.show_client_form);var d=a(this).parents(".mdjm-client-row-header");d.siblings(".mdjm-client-add-event-sections-wrap").slideToggle();var e;e=c?a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".mdjm-client-add-event-sections-wrap")):a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".mdjm-repeatable-row-standard-fields")),e.focus()}),a(document.body).on("click",".toggle-client-details-option-section",function(b){b.preventDefault();var c=a(this).html()===mdjm_admin_vars.show_client_details;c?a(this).html(mdjm_admin_vars.hide_client_details):a(this).html(mdjm_admin_vars.show_client_details);var d=a(this).parents(".mdjm-client-row-header");d.siblings(".mdjm-client-details-event-sections-wrap").slideToggle();var e;c||(e=a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".mdjm-repeatable-row-standard-fields")),e.focus())}),a(document.body).on("click","#toggle_client_details",function(){a("#mdjm-event-client-details").toggle("slow")}),a(document.body).on("change","#client_name",function(b){if(b.preventDefault(),""===a("#client_name").val())return void a("#mdjm-event-add-new-client-fields").hide("slow");if("mdjm_add_client"===a("#client_name").val())a("#mdjm-event-add-new-client-fields").show("slow");else{a("#mdjm-event-add-new-client-fields").hide("slow");var c={client_id:a("#client_name").val(),event_id:a("#post_ID").val(),action:"mdjm_refresh_client_details"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm-event-client-details").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>')},success:function(b){a("#mdjm-loading").replaceWith(b.client_details)}}).fail(function(b){a("#mdjm-event-client-details").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>'),window.console&&window.console.log&&console.log(b)})}}),a(document.body).on("click","#mdjm-add-client",function(b){if(b.preventDefault(),a("#client_firstname").val().length<1)return void a("#client_firstname").addClass("mdjm-form-error");if(a("#client_email").val().length<1)return void a("#client_email").addClass("mdjm-form-error");var c={client_firstname:a("#client_firstname").val(),client_lastname:a("#client_lastname").val(),client_email:a("#client_email").val(),client_address1:a("#client_address1").val(),client_address2:a("#client_address2").val(),client_town:a("#client_town").val(),client_county:a("#client_county").val(),client_postcode:a("#client_postcode").val(),client_phone:a("#client_phone").val(),client_phone2:a("#client_phone2").val(),action:"mdjm_event_add_client"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".mdjm-client-option-fields").addClass("mdjm-mute"),a("#mdjm-add-client").hide("fast")},success:function(b){a("#mdjm-add-client-fields").slideToggle(),a("#add-client-action").html(mdjm_admin_vars.show_client_form),a("#client_name").empty(),a("#client_firstname").val(""),a("#client_lastname").val(""),a("#client_email").val(""),a("#client_address1").val(""),a("#client_address2").val(""),a("#client_town").val(""),a("#client_county").val(""),a("#client_postcode").val(""),a("#client_phone").val(""),a("#client_phone2").val(""),a("#client_name").append(b.client_list),a("#mdjm-add-client").show("fast"),a("#_mdjm_event_block_emails").prop("checked",!1),a("#mdjm_reset_pw").prop("checked",!0),a("#client_name").trigger("chosen:updated"),a(".mdjm-client-option-fields").removeClass("mdjm-mute"),"error"===b.type&&alert(b.message)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#toggle_custom_client_fields",function(){a("#mdjm_event_custom_client_fields").toggle("fast")}),a(document.body).on("click","#toggle_custom_event_fields",function(){a("#mdjm_event_custom_event_fields").toggle("fast")}),a(document.body).on("click","#toggle_custom_venue_fields",function(){a("#mdjm_event_custom_venue_fields").toggle("fast")})},employee:function(){a(document.body).on("click","#new_mdjm_role",function(b){if(b.preventDefault(),a("#add_mdjm_role").hasClass("mdjm-form-error")&&a("#add_mdjm_role").removeClass("mdjm-form-error"),a("#add_mdjm_role").val().length<1)return void a("#add_mdjm_role").addClass("mdjm-form-error");var c={role_name:a("#add_mdjm_role").val(),action:"mdjm_add_role"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a('input[type="submit"]').prop("disabled",!0),a("#new_mdjm_role").hide(),a("#pleasewait").show(),a("#all_roles").addClass("mdjm-mute"),a("#employee_role").addClass("mdjm-mute"),a("#all_roles").fadeTo("slow",.5),a("#employee_role").fadeTo("slow",.5)},success:function(b){"success"===b.type?(a("#all_roles").empty(),a("#employee_role").empty(),a("#all_roles").append(b.options),a("#employee_role").append(b.options),a("#add_mdjm_role").val(""),a("#all_roles").fadeTo("slow",1),a("#all_roles").removeClass("mdjm-mute"),a("#employee_role").fadeTo("slow",1),a("#employee_role").removeClass("mdjm-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new_mdjm_role").show()):(alert(b.msg),a("#all_roles").fadeTo("slow",1),a("#all_roles").removeClass("mdjm-mute"),a("#employee_role").fadeTo("slow",1),a("#employee_role").removeClass("mdjm-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new_mdjm_role").show())}})}),a(document.body).on("click",".toggle-add-worker-section",function(b){b.preventDefault();var c=a(this).html()===mdjm_admin_vars.show_workers;c?a(this).html(mdjm_admin_vars.hide_workers):a(this).html(mdjm_admin_vars.show_workers),a(".mdjm-event-workers-sections-wrap").slideToggle(),a(".mdjm-event-workers-sections-wrap").is(":visible")&&a("#event_new_employee_role").focus()}),a(document.body).on("change","#event_new_employee_wage",function(){var b=a(this).val();b.length>0&&a(this).val(mdjmFormatCurrency(b).substr(1))}),a(document.body).on("click","#add_event_employee",function(b){b.preventDefault();var c={event_id:a("#post_ID").val(),employee_id:a("#event_new_employee").val(),employee_role:a("#event_new_employee_role").val(),employee_wage:a("#event_new_employee_wage").val(),action:"add_employee_to_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".mdjm-event-workers-sections-wrap").addClass("mdjm-mute"),a("#mdjm-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert(b.msg),a("#mdjm-event-employee-list").html(b.employees),a("#mdjm-event-employee-list").slideToggle(),a(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),a("#event_new_employee_role").val("").trigger("chosen:updated"),a("#event_new_employee").val("").trigger("chosen:updated"),a("#event_new_employee_wage").val("")}}).fail(function(b){a("#mdjm-event-employee-list").slideToggle(),a(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),window.console&&window.console.log&&console.log(b)})}),a(document.body).on("click",".remove_event_employee",function(b){b.preventDefault();var c={event_id:a("#post_ID").val(),employee_id:a(this).data("employee_id"),action:"remove_employee_from_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".mdjm-event-workers-sections-wrap").addClass("mdjm-mute"),a("#mdjm-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert("Error"),a("#mdjm-event-employee-list").html(b.employees),a("#mdjm-event-employee-list").slideToggle(),a(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute")}}).fail(function(b){a("#mdjm-event-employee-list").slideToggle(),a(".mdjm-event-workers-sections-wrap").removeClass("mdjm-mute"),window.console&&window.console.log&&console.log(b)})})},equipment:function(){a(document.body).on("change","#_mdjm_event_package,#event_addons,#_mdjm_event_additional_cost,#_mdjm_event_discount",function(){d()}),a(document.body).on("focusout","#_mdjm_event_cost",function(){mdjm_admin_vars.deposit_is_pct&&c()}),a(document.body).on("change","#_mdjm_event_dj,#mdjm_event_type,#display_event_date",function(b){b.preventDefault();var c=a("#_mdjm_event_deposit").val(),e={package:a("#_mdjm_event_package option:selected").val(),addons:a("#event_addons").val()||[],employee:a("#_mdjm_event_dj").val(),event_type:a("#mdjm_event_type").val(),event_date:a("#_mdjm_event_date").val(),action:"refresh_event_package_options"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#mdjm-event-equipment-row").hide(),a("#mdjm-equipment-loader").show()},success:function(b){"success"===b.type?(a("#_mdjm_event_package").empty(),a("#_mdjm_event_package").append(b.packages),a("#_mdjm_event_package").trigger("chosen:updated"),a("#event_addons").empty(),a("#event_addons").append(b.addons),a("#event_addons").trigger("chosen:updated"),a("#mdjm-equipment-loader").hide(),a("#mdjm-event-equipment-row").show(),d()):alert(b.msg),a("#mdjm-equipment-loader").hide(),a("#mdjm-event-equipment-row").show()}}).fail(function(b){window.console&&window.console.log&&console.log(b),a("#_mdjm_event_deposit").val(c)})}),a(document.body).on("change","#_mdjm_event_package",function(b){b.preventDefault();var c={package:a("#_mdjm_event_package option:selected").val(),employee:a("#_mdjm_event_dj").val(),event_type:a("#mdjm_event_type").val(),event_date:a("#_mdjm_event_date").val(),selected:a("#event_addons").val()||[],action:"refresh_event_addon_options"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm-event-equipment-row").hide(),a("#mdjm-equipment-loader").show()},success:function(b){"success"===b.type?(a("#event_addons").empty(),a("#event_addons").append(b.addons),a("#event_addons").trigger("chosen:updated"),d(),a("#mdjm-equipment-loader").hide(),a("#mdjm-event-equipment-row").show()):alert(b.msg),a("#mdjm-equipment-loader").hide(),a("#mdjm-event-equipment-row").show()}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},playlist:function(){a(document.body).on("change","#_mdjm_event_playlist",function(){a("#mdjm-playlist-limit").toggle("fast")})},tasks:function(){a(document.body).on("change","#mdjm_event_task",function(){var b=a(this).val();"0"===b?a("#mdjm-event-task-run").addClass("mdjm-hidden"):a("#mdjm-event-task-run").removeClass("mdjm-hidden")}),a(document.body).on("click","#mdjm-run-task",function(b){b.preventDefault(),a("#mdjm-event-tasks").addClass("mdjm-mute");var c=a("#mdjm_event_task").val(),d=a("#post_ID").val();if("reject-enquiry"===c){var e=a("#client_name").val(),f={page:"mdjm-comms",recipient:e,template:mdjm_admin_vars.unavailable_template,event_id:d,"mdjm-action":"respond_unavailable"},g=mdjm_admin_vars.admin_url+"admin.php?";return void(window.location.href=g+a.param(f))}var h={event_id:d,task:c,action:"mdjm_execute_event_task"};a.ajax({type:"POST",dataType:"json",data:h,url:ajaxurl,beforeSend:function(){a("#mdjm-run-task").addClass("mdjm-hidden"),a("#mdjm-spinner").css("visibility","visible")},complete:function(){a("#mdjm-event-tasks").removeClass("mdjm-mute")},success:function(b){b.success?(a("#mdjm-event-task-run").addClass("mdjm-hidden"),a("#mdjm_event_status").val(b.data.status),a("#mdjm_event_status").trigger("chosen:updated"),a(".task-history-items").html(b.data.history),a(".task-history-items").removeClass("description"),a("#mdjm-run-task").removeClass("mdjm-hidden"),a("#mdjm_event_task").val("0"),a("#mdjm_event_task").trigger("chosen:updated"),a("#mdjm-spinner").css("visibility","hidden")):alert("Error")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},time:function(){a(document.body).on("change","#display_event_date",function(){a("#dj_setup_date").val().length<1&&a("#dj_setup_date").val(a("#display_event_date").val())}),mdjm_admin_vars.setup_time_interval&&a(document.body).on("change","#event_start_hr, #event_start_min, #event_start_period",function(){var b=a("#event_start_hr").val(),c=a("#event_start_min").val(),d="",e=a("#_mdjm_event_date").val();"H:i"!==mdjm_admin_vars.time_format&&(d=" "+a("#event_start_period").val());var f=b+":"+c+d,g={time:f,date:e,action:"mdjm_event_setup_time"};a.ajax({type:"POST",dataType:"json",data:g,url:ajaxurl,success:function(b){a("#dj_setup_hr").val(b.data.hour),a("#dj_setup_min").val(b.data.minute),"H:i"!==mdjm_admin_vars.time_format&&a("#dj_setup_period").val(b.data.meridiem),(a("#dj_setup_date").val().length<1||a("#dj_setup_date").val()!==b.data.date)&&(a("#dj_setup_date").val(b.data.date),a("#_mdjm_event_djsetup").val(b.data.datepicker))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},travel:function(){a(document.body).on("change","#venue_id",function(){"client"===a("#venue_id").val()&&b()}),a(document.body).on("change","#_mdjm_event_dj,#venue_address1,#venue_address2,#venue_town,#venue_county,#venue_postcode",function(){e(),a("#_mdjm_event_package").trigger("change")});var b=function(){if(a("#client_name").length){var b=a("#client_name").val(),c={client_id:b,action:"mdjm_set_client_venue"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){b.address1&&a("#venue_address1").val(b.address1),b.address2&&a("#venue_address2").val(b.address2),b.town&&a("#venue_town").val(b.town),b.county&&a("#venue_county").val(b.county),b.postcode&&a("#venue_postcode").val(b.postcode),setTimeout(function(){e()},1e3),setTimeout(function(){d()},1750)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}}},type:function(){a(document.body).on("click",".toggle-event-type-option-section",function(b){b.preventDefault(),a(".mdjm-add-event-type-sections-wrap").slideToggle(),a(".mdjm-add-event-type-sections-wrap").is(":visible")&&a("#event_type_name").focus()}),a(document.body).on("click","#mdjm-add-event-type",function(b){b.preventDefault();var c={type:a("#event_type_name").val(),current:a("#mdjm_event_type").val(),action:"add_event_type"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".mdjm-event-option-fields").addClass("mdjm-mute"),a("#mdjm-add-event-type").hide("fast")},success:function(b){if(b){if("success"!==b.data.msg)return a("#event_type_name").addClass("mdjm-form-error"),void a("#mdjm-add-event-type").show("fast");a("#event_type_name").val(""),a(".mdjm-add-event-type-sections-wrap").slideToggle(),a("#mdjm_event_type").empty(),a("#mdjm_event_type").append(b.data.event_types),a("#mdjm_event_type").trigger("chosen:updated"),a("#mdjm-add-event-type").show("fast"),a(".mdjm-event-option-fields").removeClass("mdjm-mute")}else alert(b.data.msg),a("#mdjm-add-event-type").show("fast")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#mdjm_block_emails",function(){a(".mdjm-quote-template").toggle("fast")})},txns:function(){a(document.body).on("click","#mdjm_txn_toggle",function(){a("#mdjm_event_txn_table").toggle("slow")}),a(document.body).on("click","#toggle_add_txn_fields",function(){a("#mdjm_event_add_txn_table tbody").toggle("slow"),a("#save-event-txn").toggle("fast"),"show form"===a("#toggle_add_txn_fields").text()?a("#toggle_add_txn_fields").text("hide form"):a("#toggle_add_txn_fields").text("show form")}),a(document.body).on("change","#mdjm_txn_direction",function(){"In"===a("#mdjm_txn_direction").val()&&(a("#mdjm_txn_from_container").removeClass("mdjm-hidden"),a("#mdjm_txn_to_container").addClass("mdjm-hidden"),a("#mdjm-txn-email").removeClass("mdjm-hidden")),"Out"!==a("#mdjm_txn_direction").val()&&""!==a("#mdjm_txn_direction").val()||(a("#mdjm_txn_to_container").removeClass("mdjm-hidden"),a("#mdjm_txn_from_container").addClass("mdjm-hidden"),a("#mdjm-txn-email").addClass("mdjm-hidden"))}),a(document.body).on("click","#save_transaction",function(b){if(b.preventDefault(),a("#mdjm_txn_amount").val().length<1)return alert(mdjm_admin_vars.no_txn_amount),!1;if(a("#mdjm_txn_date").val().length<1)return alert(mdjm_admin_vars.no_txn_date),!1;if(a("#mdjm_txn_for").val().length<1)return alert(mdjm_admin_vars.no_txn_for),!1;if(a("#mdjm_txn_src").val().length<1)return alert(mdjm_admin_vars.no_txn_src),!1;var c={event_id:a("#post_ID").val(),client:a("#client_name").val(),amount:a("#mdjm_txn_amount").val(),date:a("#mdjm_txn_date").val(),direction:a("#mdjm_txn_direction").val(),from:a("#mdjm_txn_from").val(),to:a("#mdjm_txn_to").val(),for:a("#mdjm_txn_for").val(),src:a("#mdjm_txn_src").val(),send_notice:a("#mdjm_manual_txn_email").is(":checked")?1:0,action:"add_event_transaction"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm_event_txn_table").replaceWith('<div id="mdjm-loading" class="mdjm-loader"><img src="'+mdjm_admin_vars.ajax_loader+'" /></div>')},success:function(b){"success"===b.type?("Y"===b.deposit_paid&&a("#deposit_paid").prop("checked",!0),"Y"===b.balance_paid&&a("#balance_paid").prop("checked",!0),b.event_status!==a("#mdjm_event_status").val()&&a("#mdjm_event_status").val(b.event_status)):alert(b.msg),a("#mdjm-loading").replaceWith('<div id="mdjm_event_txn_table">'+b.transactions+"</div>")}}).fail(function(b){a("#mdjm-loading").replaceWith('<div id="mdjm_event_txn_table">'+response.transactions+"</div>"),window.console&&window.console.log&&console.log(b)})})},venue:function(){"post.php"===mdjm_admin_vars.current_page&&"manual"===a("#venue_id").val()&&a(".mdjm-add-event-venue-sections-wrap").show(),a(document.body).on("click",".toggle-event-view-venue-option-section",function(b){b.preventDefault();var c=a(this).html()===mdjm_admin_vars.show_venue_details;c?a(this).html(mdjm_admin_vars.hide_venue_details):a(this).html(mdjm_admin_vars.show_venue_details),a(".mdjm-event-venue-details-sections-wrap").slideToggle()}),a(document.body).on("click",".toggle-event-add-venue-option-section",function(b){b.preventDefault(),a(".mdjm-add-event-venue-sections-wrap").slideToggle(),a(".mdjm-add-event-venue-sections-wrap").is(":visible")&&a("#venue_name").focus()}),a(document.body).on("change","#venue_id",function(a){a.preventDefault(),b()}),a(document.body).on("click","#mdjm-add-venue",function(c){if(c.preventDefault(),a("#venue_name").val().length<1)return void a("#venue_name").addClass("mdjm-form-error");var d={venue_name:a("#venue_name").val(),venue_contact:a("#venue_contact").val(),venue_email:a("#venue_email").val(),venue_address1:a("#venue_address1").val(),venue_address2:a("#venue_address2").val(),venue_town:a("#venue_town").val(),venue_county:a("#venue_county").val(),venue_postcode:a("#venue_postcode").val(),venue_phone:a("#venue_phone").val(),action:"mdjm_add_venue"};a.ajax({type:"POST",dataType:"json",data:d,url:ajaxurl,beforeSend:function(){a(".mdjm-event-option-fields").addClass("mdjm-mute"),a("#mdjm-add-venue").hide("fast")},success:function(c){a(".mdjm-add-event-venue-sections-wrap").slideToggle(),a("#venue_id").empty(),a("#venue_id").append(c.venue_list),a("#mdjm-add-venue").show(),a("#venue_id").trigger("chosen:updated"),b(),a(".mdjm-event-option-fields").removeClass("mdjm-mute"),"error"===c.type&&(alert(c.message),a("#mdjm-add-venue").show("fast"))}}).fail(function(b){a("#mdjm-add-venue").show("fast"),window.console&&window.console.log&&console.log(b)})})}};g.init();var h={init:function(){this.add(),this.remove(),this.price()},clone_repeatable:function(b){var c=1,d=c;return b.parent().find("tr.mdjm_repeatable_row").each(function(){var b=a(this).data("key");parseInt(b)>c&&(c=b)}),d=c+=1,clone=b.clone(),clone.find("select").each(function(){a(this).val(b.find('select[name="'+a(this).attr("name")+'"]').val())}),clone.removeClass("mdjm_add_blank"),clone.attr("data-key",d),clone.find("td input, td select, textarea").val(""),clone.find("input, select, textarea").each(function(){var b=a(this).attr("name"),c=a(this).attr("id");b&&(b=b.replace(/\[(\d+)\]/,"["+parseInt(d)+"]"),a(this).attr("name",b)),"undefined"!=typeof c&&(c=c.replace(/(\d+)/,parseInt(d)),a(this).attr("id",c))}),clone.find("span.mdjm_price_id").each(function(){a(this).text(parseInt(d))}),clone.find("span.mdjm_file_id").each(function(){a(this).text(parseInt(d))}),clone.find(".mdjm_repeatable_default_input").each(function(){a(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){a(document.body).on("click",".submit .mdjm_add_repeatable",function(b){b.preventDefault();var c=a(this),d=c.parent().parent().prev("tr"),e=h.clone_repeatable(d);e.insertAfter(d).find("input, textarea, select").filter(":visible").eq(0).focus(),e.find(".mdjm-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_multiple:mdjm_admin_vars.select_months}),e.find(".package-items").css("width","100%")})},move:function(){a(".mdjm_repeatable_table tbody").sortable({handle:".mdjm_draghandle",items:".mdjm_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=0;a(this).find("tr").each(function(){a(this).find("input.mdjm_repeatable_index").each(function(){a(this).val(b)}),b++})}})},remove:function(){a(document.body).on("click",".mdjm_remove_repeatable",function(b){b.preventDefault();var c=a(this).parent().parent("tr"),d=c.parent().find("tr").length-1,e=a(this).data("type"),f="tr.mdjm_repeatable_"+e+"s";if("price"===e){var g=c.data("key");a('.mdjm_repeatable_condition_field option[value="'+g+'"]').remove()}if(d>1)a("input, select",c).val(""),c.fadeOut("fast").remove();else switch(e){case"price":alert(mdjm_admin_vars.one_month_min);break;case"item":alert(mdjm_admin_vars.one_item_min);break;default:alert(mdjm_admin_vars.one_month_min)}a(f).each(function(b){a(this).find("input, select").each(function(){var c=a(this).attr("name");c=c.replace(/\[(\d+)\]/,"["+b+"]"),a(this).attr("name",c).attr("id",c)})})})},price:function(){a(document.body).on("click","#_package_restrict_date",function(){a("#mdjm-package-month-selection").toggle("fast")}),a(document.body).on("click","#_addon_restrict_date",function(){a("#mdjm-addon-month-selection").toggle("fast")}),a(document.body).on("click","#_package_variable_pricing",function(){a("#mdjm-package-variable-price-fields").toggle("fast")}),a(document.body).on("click","#_addon_variable_pricing",function(){a("#mdjm-addon-variable-price-fields").toggle("fast")})}};h.init();var i={init:function(){this.content()},content:function(){var b=function(b){var c={recipient:b,action:"mdjm_user_events_dropdown"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm_email_event").addClass("mdjm-updating"),a("#mdjm_email_event").fadeTo("slow",.5)},success:function(b){a("#mdjm_email_event").empty(),a("#mdjm_email_event").append(b.event_list),a("#mdjm_email_event").fadeTo("slow",1),a("#mdjm_email_event").removeClass("mdjm-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})};mdjm_admin_vars.load_recipient&&(a("#mdjm_email_to").val(mdjm_admin_vars.load_recipient),b(mdjm_admin_vars.load_recipient)),a(document.body).on("change","#mdjm_email_to",function(c){c.preventDefault();var d=a("#mdjm_email_to").val();b(d)}),a(document.body).on("change","#mdjm_email_template",function(b){b.preventDefault();var c={template:a("#mdjm_email_template").val(),action:"mdjm_set_email_content"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm_email_subject").addClass("mdjm-updating"),a("#mdjm_email_subject").fadeTo("slow",.5),a("#mdjm_email_content").addClass("mdjm-updating"),a("#mdjm_email_content").fadeTo("slow",.5),a("#mdjm_email_template").addClass("mdjm-updating"),a("#mdjm_email_template").fadeTo("slow",.5),tinymce.execCommand("mceToggleEditor",!1,"mdjm_email_content")},success:function(b){"success"===b.type?(a("#mdjm_email_content").empty(),tinyMCE.activeEditor.setContent(""),a("#mdjm_email_subject").val(b.updated_subject),tinyMCE.activeEditor.setContent(b.updated_content),a("#mdjm_email_content").val(b.updated_content)):alert(b.msg),a("#mdjm_email_subject").fadeTo("slow",1),a("#mdjm_email_subject").removeClass("mdjm-updating"),a("#mdjm_email_content").fadeTo("slow",1),a("#mdjm_email_content").removeClass("mdjm-updating"),a("#mdjm_email_template").removeClass("mdjm-updating"),a("#mdjm_email_template").fadeTo("slow",1),tinymce.execCommand("mceToggleEditor",!1,"mdjm_email_content")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};i.init();var j={init:function(){this.template_select()},template_select:function(){a(document.body).on("change","#mdjm_task_email_template",function(b){b.preventDefault();var c={template:a("#mdjm_task_email_template").val(),action:"mdjm_get_template_title"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#mdjm-task-email-subject").addClass("mdjm-updating"),a("#mdjm-task-email-subject").fadeTo("slow",.5)},success:function(b){b.title&&a("#mdjm-task-email-subject").val(b.title),a("#mdjm-task-email-subject").fadeTo("slow",1),a("#mdjm-task-email-subject").removeClass("mdjm-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};j.init();var k={init:function(){this.date_options()},date_options:function(){a("#mdjm-graphs-date-options").change(function(){var b=a(this),c=a("#mdjm-date-range-options");"other"===b.val()?c.show():c.hide()})}};k.init();var l={init:function(){this.submit(),this.dismiss_message()},submit:function(){
var b=this;a(document.body).on("submit",".mdjm-export-form",function(c){c.preventDefault();var d=a(this).find('input[type="submit"]');if(!d.hasClass("button-disabled")){var e=a(this).serialize();d.addClass("button-disabled"),a(this).find(".notice-wrap").remove(),a(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="mdjm-progress"><div></div></div></div>'),b.process_step(1,e,b)}})},process_step:function(b,c,d){a.ajax({type:"POST",url:ajaxurl,data:{form:c,action:"mdjm_do_ajax_export",step:b},dataType:"json",success:function(b){if("done"===b.step||b.error||b.success){var e=a(".mdjm-export-form").find(".mdjm-progress").parent().parent(),f=e.find(".notice-wrap");if(e.find(".button-disabled").removeClass("button-disabled"),b.error){var g=b.message;f.html('<div class="updated error"><p>'+g+"</p></div>")}else if(b.success){var h=b.message;f.html('<div id="mdjm-batch-success" class="updated notice is-dismissible"><p>'+h+'<span class="notice-dismiss"></span></p></div>')}else f.remove(),window.location=b.url}else a(".mdjm-progress div").animate({width:b.percentage+"%"},50,function(){}),d.process_step(parseInt(b.step),c,d)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},dismiss_message:function(){a("body").on("click","#mdjm-batch-success .notice-dismiss",function(){a("#mdjm-batch-success").parent().slideUp("fast")})}};l.init(),"mdjm-event_page_mdjm-comms"===mdjm_admin_vars.current_page&&a("#mdjm_form_send_comms").validate({errorClass:"mdjm-form-error",validClass:"mdjm-form-valid",focusInvalid:!1,rules:{},messages:{mdjm_email_to:null,mdjm_email_subject:null,mdjm_email_content:null}}),mdjm_admin_vars.editing_event&&(a("#post").validate({errorClass:"mdjm-form-error",validClass:"mdjm-form-valid",focusInvalid:!1,rules:{client_name:{required:!0,minlength:1},display_event_date:{required:!0},_mdjm_event_cost:{number:!0},_mdjm_event_deposit:{number:!0}},messages:{client_name:null,display_event_date:null,_mdjm_event_cost:null,_mdjm_event_deposit:null}}),a(document.body).on("click","#save-post",function(){if(a("#_mdjm_event_cost").val()<"0.01")return confirm(mdjm_admin_vars.zero_cost)}))});var mdjmFormatCurrency=function(a){var b=parseFloat(a),c=mdjm_admin_vars.currency,d=mdjm_admin_vars.currency_decimals;return b.toLocaleString(c,{style:"currency",currency:c,minimumFractionDigits:d,maximumFractionDigits:d})},mdjmFormatNumber=function(a){var b=parseFloat(a),c=mdjm_admin_vars.currency;return b.toLocaleString(c,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},mdjmLabelFormatter=function(a){return'<div style="font-size:12px; text-align:center; padding:2px">'+a+"</div>"},mdjmLegendFormatterSources=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="mdjm-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="mdjm-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+mdjmFormatNumber(b.data[0][1])+")</div>",f='<div id="'+b.mdjm_vars.id+c+'" class="mdjm-legend-item-wrapper">'+d+e+"</div>";return jQuery("#mdjm-pie-legend-"+b.mdjm_vars.id).append(f),f},mdjmLegendFormatterEarnings=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="mdjm-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="mdjm-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+mdjmFormatCurrency(b.data[0][1])+")</div>",f='<div id="'+b.mdjm_vars.id+c+'" class="mdjm-legend-item-wrapper">'+d+e+"</div>";return jQuery("#mdjm-pie-legend-"+b.mdjm_vars.id).append(f),f};